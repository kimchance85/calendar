<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>íŒ€ ìº˜ë¦°ë” Â· v18.9</title>

<!-- FullCalendar -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.19/index.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.19/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.19/locales/ko.global.min.js"></script>
<!-- html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
:root{
  --bg:#f6f8fb; --card:#fff; --line:#e5e7eb; --muted:#64748b;
  --brand:#4f46e5; --brand2:#06b6d4; --radius:16px;
  --shadow-sm:0 6px 18px rgba(16,24,40,.06);
  --shadow-lg:0 26px 60px rgba(16,24,40,.12);
}

/* reset */
*{box-sizing:border-box}
html,body{margin:0;background:radial-gradient(1200px 800px at 15% -10%, #eef2ff 0%, var(--bg) 55%), var(--bg);color:#0f172a;font-family:ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,"Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic",Arial,sans-serif;}
a{color:inherit;text-decoration:none}

/* layout */
.wrap{max-width:1200px;margin:28px auto;padding:0 16px;}
.hero{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;gap:12px;}
.brand{font-weight:900;font-size:26px;background:linear-gradient(90deg,var(--brand),var(--brand2));-webkit-background-clip:text;background-clip:text;color:transparent}
.badge{font-size:12px;color:#334155;background:#f1f5f9;border:1px solid #e2e8f0;padding:6px 10px;border-radius:999px}
.toolbar{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow-lg)}
.left,.right{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.title{font-weight:700;border:1px solid var(--line);padding:10px 14px;border-radius:12px;background:#fff;min-width:220px}
button,select{background:#fff;border:1px solid var(--line);padding:10px 14px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow-sm)}
button:hover,select:hover{border-color:#cbd5e1}
.primary{background:linear-gradient(180deg,#6366f1,#4f46e5);border:none;color:#fff;box-shadow:0 10px 28px rgba(79,70,229,.35)}
.ghost{background:#f8fafc;border:1px dashed #e5e7eb}
.board{margin-top:14px;background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow-lg)}
.export-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:10px}
.export-title{font-size:18px;font-weight:800}
.export-range{font-size:12px;color:#64748b}
.hint{margin-top:10px;color:#475569;font-size:12px}

/* read-only banner */
.banner{display:none;margin:-6px auto 10px;max-width:1200px;padding:10px 14px;border:1px solid #e5e7eb;border-left:6px solid #f59e0b;background:#fffbeb;border-radius:12px;box-shadow:var(--shadow-sm)}
.banner b{color:#92400e}
.banner .act{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.banner .act button{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:8px 12px}

/* FullCalendar: ì›”ê°„(ì¥ì†Œ + ì‹œê°„ë§Œ) */
.fc-theme-standard .fc-scrollgrid{border-color:var(--line)}
.fc .fc-button{background:#fff;border:1px solid var(--line)}
.fc .fc-button-primary:not(:disabled){background:#4f46e5;border:none;color:#fff}
.fc .fc-toolbar-title{display:none}
.fc .fc-col-header-cell-cushion{color:#0f172a;font-weight:600}
.fc .fc-daygrid-day-number{color:#334155}
.fc .fc-day-today{background:rgba(99,102,241,.10)}
.fc-daygrid .fc-event{background:transparent!important;border:none!important;padding:0 0 2px 0!important}
.fc .mon-mini{display:flex;flex-direction:column;gap:2px}
.fc .mm-top{display:flex;align-items:center;gap:6px;min-width:0}
.fc .mm-dot{width:8px;height:8px;border-radius:50%;flex:none}
.fc .mm-place{font-weight:700;font-size:12.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.fc .mm-time{font-size:11px;color:#475569}

/* ì£¼ê°„ ë³´ë“œ */
.week-board{display:none}
.week-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.day-card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px;min-height:160px;box-shadow:var(--shadow-sm);display:flex;flex-direction:column;cursor:pointer}
.day-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.day-name{font-weight:800}
.day-date{font-size:12px;color:#64748b}
.event-list{display:flex;flex-direction:column;gap:10px;margin-top:4px}
.event-chip{display:flex;flex-direction:column;gap:8px;align-items:flex-start;background:#fff;border:1px solid #e2e8f0;border-left:6px solid var(--c);padding:12px;border-radius:12px;cursor:pointer;box-shadow:0 1px 3px rgba(15,23,42,.06)}
.event-chip .top{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;width:100%}
.event-chip .main{display:flex;align-items:center;gap:10px;min-width:0;flex:1}
.event-chip img.avatar{width:26px;height:26px;border-radius:50%;object-fit:cover;border:1px solid #e5e7eb}
.event-chip .main-ttl{font-size:18px;font-weight:800;line-height:1.2;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.event-chip .slash{opacity:.6;margin:0 6px}
.event-chip .right{display:flex;gap:8px;align-items:center;flex:none}
.event-chip .time-badge{font-size:12px;font-weight:700;padding:6px 10px;border-radius:999px;background:rgba(79,70,229,.10);border:1px solid #e0e7ff;color:#3730a3;white-space:nowrap}
.event-chip .edit-btn{font-size:12px;padding:6px 10px;border-radius:999px;background:#fff;border:1px solid #e5e7eb}
.event-chip .meta{display:flex;flex-direction:column;gap:6px;font-size:13px;color:#1f2937;width:100%}
.addr-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.map-btn{font-size:12px;padding:2px 8px;border:1px solid #e5e7eb;border-radius:999px;background:#fff}
.day-card.empty .event-list::before{content:'ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤';color:#64748b;font-size:12px}
@media (max-width:720px){.week-grid{grid-template-columns:1fr}}

/* ê³µí†µ ëª¨ë‹¬ */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:16px;z-index:1800}
.modal.show{display:flex}
.scrim{position:absolute;inset:0;background:rgba(15,23,42,.35);backdrop-filter:blur(3px)}
.dialog{position:relative;width:min(960px,96vw);max-height:min(92vh,92dvh);overflow:auto;background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:16px;box-shadow:var(--shadow-lg)}
.dialog .sticky-bar{position:sticky;bottom:0;padding:10px 12px calc(10px + env(safe-area-inset-bottom));background:linear-gradient(180deg,rgba(255,255,255,0),#fff 60%);border-top:1px solid #e5e7eb;z-index:5}

/* QuickAdd */
#quickAdd .quick-card{width:min(560px,96vw)}
.qrow{display:flex;flex-direction:column;gap:6px;margin:10px 0}
.qtit{font-size:12px;color:#64748b}
.opts{display:flex;flex-wrap:wrap;gap:10px}
.opt{display:flex;align-items:center;gap:8px;border:1px solid #e5e7eb;border-radius:999px;padding:8px 12px;cursor:pointer;background:#fff}
.opt img{width:20px;height:20px;border-radius:50%;object-fit:cover;border:1px solid #e5e7eb}
.opt .dot{width:10px;height:10px;border-radius:50%}
.opt.selected{border-color:#6366f1;box-shadow:0 0 0 2px rgba(99,102,241,.12) inset}
.qmemo textarea{border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;line-height:1.6;font-size:15px;min-height:120px;max-height:60vh;resize:vertical;width:100%}
.qmemo .inline-actions{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-top:8px}
.qmemo .inline-actions button{border:1px solid #e5e7eb;background:#fff;border-radius:8px;padding:6px 8px;font-size:12px}
.route-up{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.route-up img{max-width:220px;max-height:160px;border:1px solid #e5e7eb;border-radius:10px;object-fit:contain;background:#f8fafc}
.route-up input[type="file"]{border:1px dashed #e5e7eb;padding:8px;border-radius:10px;background:#fff}
.sup-grid{display:flex;flex-direction:column;gap:8px}
.sup-item{border:1px solid #e5e7eb;border-radius:10px;padding:8px;display:grid;grid-template-columns:48px 1fr auto 24px;gap:8px;align-items:center}
.sup-item img{width:48px;height:48px;border-radius:50%;object-fit:cover;border:1px solid #e5e7eb}
.sup-item input{border:1px solid #e5e7eb;border-radius:8px;padding:6px 8px;width:100%}
.sup-item .btn{border:1px solid #e5e7eb;background:#fff;border-radius:8px;padding:6px 8px;font-size:12px}
.sup-item .del{border:1px solid #fecaca;color:#b91c1c}
.sup-preset .opt img{width:18px;height:18px;border-radius:50%;object-fit:cover;border:1px solid #e5e7eb}

/* ì¹´ë“œ ë¯¸ë¦¬ë³´ê¸° + ê³µìœ ì¹´ë“œ */
.card-preview{position:relative;--cw:540;--ch:675;--k:.66;width:calc(var(--cw)*1px*var(--k));height:calc(var(--ch)*1px*var(--k));border:1px solid #e5e7eb;border-radius:12px;background:#f8fafc;box-shadow:0 10px 28px rgba(15,23,42,.08);overflow:auto;touch-action:none}
.card-preview>.share-card{position:absolute;left:0;top:0;transform:scale(var(--k));transform-origin:top left}

.share-card.vertical.v5{
  --c:#4f46e5; --r:20px; --sup:40px; --fs:1; --sp:.76;
  --f-meeting:32; --f-time:14; --f-name:22; --f-label:13; --f-value:15; --f-footer:12; --f-desc:15; --f-supcap:12; --f-brand:14;
  --av:110px; --supx:0px; --supy:0px; --herox:0px; --heroy:0px; --htsize:28; --htcolor:#fff;
  width:calc(var(--cw,540)*1px); height:calc(var(--ch,675)*1px);
  background:#fff;border:1px solid #e5e7eb;border-radius:var(--r);box-shadow:0 14px 40px rgba(15,23,42,.12);
  padding:calc(16px*var(--sp));overflow:hidden;display:flex;flex-direction:column
}
.scv-brand{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.scv-brand .logo{font-weight:900;font-size:calc(var(--f-brand)*1px);letter-spacing:.2px;color:#0f172a;background:linear-gradient(90deg,var(--brand),var(--brand2));-webkit-background-clip:text;background-clip:text;color:transparent}
.scv-brand .sub{font-size:12px;color:#64748b}
.scv-header{position:relative;border-radius:12px;background:linear-gradient(90deg,#22d3ee,#4f46e5);padding:12px 14px;margin-bottom:10px;overflow:hidden}
.scv-header.bg{background:#e5e7eb}
.scv-header .bgimg{position:absolute;inset:0;object-fit:cover;width:100%;height:100%;filter:brightness(.65);opacity:.85}
.scv-hcap{position:relative;display:flex;gap:10px;align-items:center;justify-content:flex-start}
.scv-meeting{font-weight:900;font-size:calc(var(--f-meeting)*1px);letter-spacing:-.02em;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.25)}
.scv-time{font-weight:800;font-size:calc(var(--f-time)*1px);color:#fff;border:1px solid rgba(255,255,255,.35);background:rgba(255,255,255,.18);padding:6px 10px;border-radius:999px}
.scv-hero{position:relative;display:flex;gap:14px;align-items:center;margin:10px 0;min-height:calc(var(--av) + 8px)}
.scv-hero .photo{width:var(--av);height:var(--av);border-radius:999px;flex:none;overflow:hidden;border:2px solid #fff;box-shadow:0 8px 20px rgba(15,23,42,.12);background:#eef2ff;position:relative;left:var(--herox);top:var(--heroy)}
.scv-hero .photo img{width:100%;height:100%;object-fit:cover}
.scv-hero .namebox{display:flex;flex-direction:column;gap:4px}
.scv-hero .name{font-weight:900;font-size:calc(var(--f-name)*1px);letter-spacing:-.02em}
.scv-hero .hero-tag{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none;color:var(--htcolor);font-weight:900;font-size:calc(var(--htsize)*1px);text-shadow:0 1px 2px rgba(0,0,0,.25)}
.scv-supporters{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-start;align-items:center;margin:6px 0 8px;transform:translate(var(--supx),var(--supy))}
.scv-supporters .sup{display:flex;gap:6px;align-items:center;padding:4px 8px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:999px}
.scv-supporters .sup img{width:var(--sup);height:var(--sup);border-radius:999px;object-fit:cover;border:1px solid #e5e7eb;background:#fff}
.scv-supporters .sup .nm{font-size:calc(var(--f-supcap)*1px);color:#0f172a;max-width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

.scv-content{display:flex;gap:14px;margin-top:4px}
.scv-info{flex:1;min-width:0}
.scv-section{padding:10px 0;border-top:1px dashed #e5e7eb}
.scv-section:first-child{border-top:none}
.scv-row{display:flex;gap:8px;align-items:center}
.scv-label{font-size:calc(var(--f-label)*1px);color:#667085;min-width:44px}
.scv-value{font-size:calc(var(--f-value)*1px);color:#0f172a}
.scv-desc .scv-value{white-space:pre-wrap;line-height:1.6;font-size:calc(var(--f-desc)*1px)}
.scv-route .frame{border:1px dashed #e5e7eb;border-radius:12px;padding:6px;background:#f8fafc;display:flex;justify-content:center;align-items:center}
.scv-route img{max-width:100%;object-fit:contain;display:block}
.scv-footer{margin-top:auto;display:flex;gap:8px;justify-content:center;align-items:center;color:#475569}
.scv-footer .f1{font-weight:800}
.scv-footer .f2{font-size:12px}

/* ì¹´ë“œ íŠœë„ˆ */
#tuner .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
#tuner .full{grid-column:1/-1}
.ctrl{display:flex;flex-direction:column;gap:6px}
.ctrl label{font-size:12px;color:#64748b}
.ctrl input[type="text"], .ctrl input[type="number"], .ctrl select{border:1px solid #e5e7eb;border-radius:10px;padding:8px 10px}
.ctrl input[type="range"]{width:100%}

/* sticky buttons */
.sticky-btns{position:sticky;bottom:0;display:flex;gap:8px;flex-wrap:wrap;padding:10px 0 calc(10px + env(safe-area-inset-bottom));background:linear-gradient(180deg,rgba(255,255,255,0),#fff 40%);border-top:1px solid #e5e7eb;z-index:5}

/* toast */
.toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#fff;border:1px solid var(--line);padding:10px 14px;border-radius:10px;display:none;z-index:3000;box-shadow:var(--shadow-lg)}
.toast.show{display:block}
</style>
</head>
<body>
<div class="wrap">
  <div class="hero">
    <div class="brand">íŒ€ ìº˜ë¦°ë”</div>
    <div class="badge" id="modeBadge">ëª¨ë“œ í™•ì¸ì¤‘â€¦</div>
  </div>

  <div id="roBanner" class="banner">
    <div id="roMsg"></div>
    <div class="act" id="roAct"></div>
  </div>

  <div class="toolbar">
    <div class="left">
      <input id="calendarTitle" class="title" value="TEAM CHANCE ì¼ì •"/>
      <select id="viewSel">
        <option value="weekShare">ì£¼ê°„</option>
        <option value="dayGridMonth">ì›”ê°„</option>
        <option value="listWeek">ëª©ë¡(ì£¼)</option>
      </select>
      <button id="todayBtn">ì˜¤ëŠ˜</button>
      <button id="prevBtn">ì´ì „</button>
      <button id="nextBtn">ë‹¤ìŒ</button>
    </div>
    <div class="right">
      <button id="weekPngBtn" class="ghost">ì£¼ê°„ PNG</button>
      <button id="openQuickBtn">+ ë¹ ë¥¸ ì¼ì •</button>
      <button id="tunerOpenBtn">ì¹´ë“œ ì¡°ì ˆ</button>
      <button id="shareLinkBtn" class="primary">ê³µìœ  ë§í¬ ë³µì‚¬</button>
      <button id="openShareBtn">ê³µìœ  ë¯¸ë¦¬ë³´ê¸°</button>
    </div>
  </div>

  <div class="board">
    <div class="export-head">
      <div class="export-title" id="exportTitle">TEAM CHANCE ì¼ì •</div>
      <div class="export-range" id="exportRange"></div>
    </div>
    <div id="calendar"></div>
    <div id="weekBoard" class="week-board">
      <div class="week-grid" id="weekGrid"></div>
    </div>
  </div>

  <p class="hint">
    â€¢ ì›”ê°„: â€œì¥ì†Œ / ì‹œê°„â€ë§Œ ê°„ê²°í•˜ê²Œ í‘œì‹œë©ë‹ˆë‹¤. Â· ì£¼ê°„: ìš”ì¼ ì¹´ë“œ í´ë¦­ì‹œ ë¹ ë¥¸ ë“±ë¡ íŒì—…<br/>
    â€¢ ì¹´ë“œ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ë‹´ë‹¹ì ì‚¬ì§„/ì´ë¦„ì„ í´ë¦­í•˜ë©´ ìˆ˜ì •, ì„œí¬í„°ëŠ” ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½, ìŠ¬ë¼ì´ë”ë¡œ í¬ê¸°/ìœ„ì¹˜ ì¡°ì •
  </p>
</div>

<!-- â–½ ë¹ ë¥¸ ì¼ì • ì¶”ê°€ -->
<div id="quickAdd" class="modal" role="dialog" aria-modal="true" aria-labelledby="qaTitle">
  <div class="scrim" id="qClose"></div>
  <div class="dialog quick-card">
    <h3 id="qaTitle" style="margin:2px 0 8px">ë¹ ë¥¸ ì¼ì • ì¶”ê°€</h3>

    <form id="quickForm">
      <div class="qrow">
        <div class="qtit">1) ì¥ì†Œ ì„ íƒ</div>
        <div class="opts" id="qLoc"></div>
      </div>

      <div class="qrow">
        <div class="qtit">2) ì‹œê°„ ì„ íƒ</div>
        <div class="opts" id="qTime"></div>
      </div>

      <div class="qrow">
        <div class="qtit">3) ë‹´ë‹¹ì ì„ íƒ</div>
        <div class="opts" id="qIns"></div>
      </div>

      <div class="qrow">
        <div class="qtit">4) ëª¨ì„ ì„ íƒ</div>
        <div class="opts" id="qMeet"></div>
      </div>

      <div class="qrow qmemo">
        <div class="qtit">ìƒì„¸ë‚´ìš©(ì„ íƒ) Â· ì¹´ë“œì— í‘œì‹œë©ë‹ˆë‹¤</div>
        <textarea id="qMemo" placeholder="ì˜ˆ) ì‹ ê·œ íŒŒíŠ¸ë„ˆ ì˜¤ë¦¬ì—”í…Œì´ì…˜ Â· ì¤€ë¹„ë¬¼: í•„ê¸°ë„êµ¬ ë“±"></textarea>
        <div class="inline-actions">
          <small>Tip: í…ìŠ¤íŠ¸ì˜ì—­ì„ <b>ë”ë¸”í´ë¦­</b>í•˜ë©´ ì „ì²´í™”ë©´ í¸ì§‘ì„ ì—´ ìˆ˜ ìˆì–´ìš”.</small>
          <div>
            <button type="button" id="memoFullBtn">ì „ì²´í™”ë©´</button>
          </div>
        </div>
      </div>

      <div class="qrow">
        <div class="qtit">ì•½ë„ ì´ë¯¸ì§€(ì„ íƒ) Â· ë¯¸ë¦¬ë³´ê¸° í¬ê¸°ë¡œ ì¹´ë“œì— ë°˜ì˜</div>
        <div class="route-up">
          <img id="qRoutePreview" alt="ì•½ë„ ë¯¸ë¦¬ë³´ê¸°"/>
          <input type="file" id="qRouteFile" accept="image/*"/>
        </div>
      </div>

      <div class="qrow">
        <div class="qtit">ì„œí¬í„° í”„ë¦¬ì…‹(í´ë¦­í•˜ì—¬ ì¶”ê°€)</div>
        <div class="opts sup-preset" id="qSupPreset"></div>
      </div>

      <div class="qrow">
        <div class="qtit">ì„œí¬í„° ë“±ë¡(ì„ íƒ) Â· ì‚¬ì§„/ì´ë¦„ (ë“œë˜ê·¸ ì •ë ¬ ê°€ëŠ¥)</div>
        <div class="sup-grid" id="qSupList"></div>
        <button type="button" id="qSupAdd" class="ghost" style="margin-top:6px">+ ì„œí¬í„° ì¶”ê°€</button>
      </div>

      <div class="sticky-btns">
        <button type="button" id="qSaveDef">ê¸°ë³¸ê°’ ì €ì¥</button>
        <span style="flex:1"></span>
        <button type="button" id="qCancel">ì·¨ì†Œ</button>
        <button type="submit" class="primary">ì €ì¥</button>
      </div>
    </form>
  </div>
</div>

<!-- â–½ ì¹´ë“œ ë³´ê¸°(ê³µìœ /ìˆ˜ì •/PNG) -->
<div id="cardModal" class="modal">
  <div class="scrim" id="cardClose"></div>
  <div class="dialog" id="cardDlg">
    <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <h3 style="margin:0">ì¼ì • ì¹´ë“œ</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="cardCopyBtn">í´ë¦½ë³´ë“œ ë³µì‚¬(ì‹¤í—˜)</button>
        <button id="cardPngBtn">PNG ì €ì¥</button>
        <button id="cardMapBtn">ì§€ë„ ì—´ê¸°</button>
        <button id="cardEditBtn">ìˆ˜ì •</button>
        <button id="cardDelBtn" style="border-color:#fecaca;color:#b91c1c;background:#fff">ì‚­ì œ</button>
      </div>
    </div>

    <div id="cardPreview" class="card-preview" style="margin:12px auto">
      <div id="shareCard" class="share-card vertical v5" style="--cw:540;--ch:675">
        <!-- ë™ì ìœ¼ë¡œ ì±„ì›€ -->
      </div>
    </div>

    <div class="sticky-bar">
      <small>ì¹´ë“œ ìœ„ì˜ ì‚¬ì§„/ì´ë¦„ í´ë¦­ìœ¼ë¡œ ì´ë¯¸ì§€Â·í…ìŠ¤íŠ¸ êµì²´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ì„œí¬í„°ëŠ” ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½)</small>
    </div>
  </div>
</div>

<!-- â–½ ì¹´ë“œ íŠœë„ˆ -->
<div id="tuner" class="modal">
  <div class="scrim" id="tunerClose"></div>
  <div class="dialog">
    <h3 style="margin:0 0 10px">ì¹´ë“œ í€µíŠœë„ˆ</h3>

    <div class="grid">
      <div class="ctrl">
        <label>ì—¬ë°± ìŠ¤ì¼€ì¼</label>
        <input type="range" min="0.5" max="1.2" step="0.01" id="optSpace">
      </div>
      <div class="ctrl">
        <label>ê¸€ì ìŠ¤ì¼€ì¼</label>
        <input type="range" min="0.8" max="1.4" step="0.01" id="optFont">
      </div>

      <div class="ctrl">
        <label>ì•„ë°”íƒ€ í¬ê¸°(px)</label>
        <input type="number" id="optAv" min="60" max="200" step="2">
      </div>
      <div class="ctrl">
        <label>ì„œí¬í„° í¬ê¸°(px)</label>
        <input type="range" id="optSup" min="26" max="80" step="1">
      </div>

      <div class="ctrl">
        <label>ì œëª© í¬ê¸°(px)</label>
        <input type="number" id="optFMeeting" min="18" max="64" step="1">
      </div>
      <div class="ctrl">
        <label>ì‹œê°„ í¬ê¸°(px)</label>
        <input type="number" id="optFTime" min="10" max="36" step="1">
      </div>

      <div class="ctrl">
        <label>ì´ë¦„ í¬ê¸°(px)</label>
        <input type="number" id="optFName" min="12" max="48" step="1">
      </div>
      <div class="ctrl">
        <label>ë³¸ë¬¸ í¬ê¸°(px)</label>
        <input type="number" id="optFDesc" min="12" max="24" step="1">
      </div>

      <div class="ctrl">
        <label>ì •ë³´ì˜ì—­ í­(%)</label>
        <input type="range" id="optInfoW" min="40" max="80" step="1">
      </div>
      <div class="ctrl">
        <label>ì •ë³´ì˜ì—­ ì •ë ¬</label>
        <select id="optInfoAnchor">
          <option value="right">ì˜¤ë¥¸ìª½</option>
          <option value="left">ì™¼ìª½</option>
        </select>
      </div>

      <div class="ctrl">
        <label>ì„œí¬í„° ì •ë ¬</label>
        <select id="optSupAlign">
          <option value="left">ì™¼ìª½</option>
          <option value="center">ê°€ìš´ë°</option>
          <option value="right">ì˜¤ë¥¸ìª½</option>
        </select>
      </div>
      <div class="ctrl">
        <label>ì„œí¬í„° ë¯¸ì„¸ì´ë™ X(px)</label>
        <input type="range" id="optSupX" min="-120" max="120" step="1">
      </div>

      <div class="ctrl">
        <label>ì„œí¬í„° ë¯¸ì„¸ì´ë™ Y(px)</label>
        <input type="range" id="optSupY" min="-120" max="120" step="1">
      </div>

      <div class="ctrl">
        <label>íˆì–´ë¡œ ë¯¸ì„¸ì´ë™ X(px)</label>
        <input type="range" id="optHeroX" min="-120" max="120" step="1">
      </div>
      <div class="ctrl">
        <label>íˆì–´ë¡œ ë¯¸ì„¸ì´ë™ Y(px)</label>
        <input type="range" id="optHeroY" min="-120" max="120" step="1">
      </div>

      <div class="ctrl">
        <label>íˆì–´ë¡œ íƒœê·¸(ë¬¸êµ¬)</label>
        <input type="text" id="optHeroTag">
      </div>
      <div class="ctrl">
        <label>íƒœê·¸ í¬ê¸°(px)</label>
        <input type="number" id="optHeroTagSize" min="12" max="56" step="1">
      </div>

      <div class="ctrl">
        <label>í—¤ë” ë°°ê²½ ì´ë¯¸ì§€</label>
        <input type="file" id="optHeaderBg" accept="image/*">
      </div>
      <div class="ctrl">
        <label>í—¤ë” ë°°ê²½ Y(%)</label>
        <input type="range" id="optHeaderPosY" min="0" max="100" step="1">
      </div>

      <div class="ctrl">
        <label>íˆì–´ë¡œ ë°°ê²½ ì´ë¯¸ì§€</label>
        <input type="file" id="optHeroBg" accept="image/*">
      </div>
      <div class="ctrl">
        <label>íˆì–´ë¡œ ë°°ê²½ Y(%)</label>
        <input type="range" id="optHeroPosY" min="0" max="100" step="1">
      </div>

      <div class="ctrl full">
        <label><input type="checkbox" id="optHideEmpty"> ë¹ˆ ì„¹ì…˜ ìˆ¨ê¹€</label>
      </div>

      <div class="ctrl">
        <label>ì¹´ë“œ ê·œê²©</label>
        <select id="optCardSize">
          <option value="1080x1350">1080Ã—1350(ì¹´ë“œë‰´ìŠ¤)</option>
          <option value="1080x1080">ì •ì‚¬ê° 1080Ã—1080</option>
          <option value="900x1200">900Ã—1200(ì†Œí˜•)</option>
        </select>
      </div>
      <div class="ctrl">
        <label>ì•½ë„ ìµœëŒ€ë†’ì´(px)</label>
        <input type="number" id="optRouteMax" min="120" max="380" step="10">
      </div>

      <div class="ctrl full">
        <label>ë¸Œëœë“œ ë¬¸êµ¬</label>
        <input type="text" id="optBrand" placeholder="ZiNRAi KOREA">
      </div>
      <div class="ctrl">
        <label>í‘¸í„°1</label>
        <input type="text" id="optF1" placeholder="Awaken the MovementğŸŒŠ">
      </div>
      <div class="ctrl">
        <label>í‘¸í„°2</label>
        <input type="text" id="optF2" placeholder="tmThis is ZiNRAiğŸ”¥">
      </div>
    </div>

    <div class="sticky-bar" style="margin-top:8px">
      <button id="tunerApply">ì ìš©</button>
      <button id="tunerSave" class="primary">ì €ì¥</button>
      <span style="flex:1"></span>
      <button id="tunerCloseBtn">ë‹«ê¸°</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
/* -------------------- ê³µìš© ìœ í‹¸ -------------------- */
const $=(q,r=document)=>r.querySelector(q);
const $$=(q,r=document)=>[...r.querySelectorAll(q)];
const fmt=(d,opt)=>new Date(d).toLocaleString('ko-KR',{...opt,hour12:false,timeZone:'Asia/Seoul'});
function uuid(){try{if(crypto.randomUUID) return crypto.randomUUID()}catch(e){} const rnd=n=>Array.from({length:n},()=>Math.floor(Math.random()*16).toString(16)).join(''); return `${rnd(8)}-${rnd(4)}-4${rnd(3)}-${(8+Math.random()*4|0).toString(16)}${rnd(3)}-${rnd(12)}`}
function textColorFor(bg){if(!bg) return '#111'; const h=bg.replace('#',''); const r=parseInt(h.substr(0,2),16),g=parseInt(h.substr(2,2),16),b=parseInt(h.substr(4,2),16); const yiq=(r*299+g*587+b*114)/1000; return yiq>=160?'#111':'#fff'}
function toast(msg){const t=$("#toast"); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1600)}
function readFileAsDataURL(file){return new Promise(res=>{if(!file) return res(''); const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=()=>res(''); fr.readAsDataURL(file)})}
function deepMerge(dst,src){ if(src==null) return dst; if(typeof src!=='object' || Array.isArray(src)) return src; dst=(dst&&typeof dst==='object'&&!Array.isArray(dst))?dst:{}; for(const k of Object.keys(src)){ const sv=src[k]; dst[k]=(sv&&typeof sv==='object'&&!Array.isArray(sv))?deepMerge(dst[k],sv):sv } return dst }

/* -------------------- ê³µìœ  ë§í¬ ëª¨ë“œ -------------------- */
let SHARE_DATA=null; try{const p=new URLSearchParams(location.search).get('s'); if(p){SHARE_DATA=JSON.parse(decodeURIComponent(escape(atob(p))))}}catch(e){}
const STORAGE_OK = (()=>{try{const k='__tc__'+Date.now(); localStorage.setItem(k,'1'); localStorage.removeItem(k); return true}catch(e){return false}})();

function showModeBanner(){
  const badge=$("#modeBadge"), banner=$("#roBanner"), msg=$("#roMsg"), act=$("#roAct"); act.innerHTML='';
  if(SHARE_DATA){ badge.textContent='ë·°ì–´ ëª¨ë“œ(ì½ê¸°ì „ìš©)'; banner.style.display='block'; msg.innerHTML='<b>ê³µìœ  ë§í¬</b>ë¡œ ì—´ë ¸ìŠµë‹ˆë‹¤. í¸ì§‘/ì €ì¥ì€ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.'; const btn=document.createElement('button'); btn.textContent='í¸ì§‘ ëª¨ë“œë¡œ ê°€ì ¸ì˜¤ê¸°'; btn.onclick=()=>{ try{ localStorage.setItem(PresetStore.KEY, JSON.stringify(SHARE_DATA.presets)); localStorage.setItem(EventStore.KEY, JSON.stringify(SHARE_DATA.events)); location.href=location.origin+location.pathname; }catch(e){ alert('ë¸Œë¼ìš°ì €ê°€ ì €ì¥ì„ ì°¨ë‹¨í•˜ì—¬ ì „í™˜ ì‹¤íŒ¨. ì£¼ì†Œì°½ì˜ ?s ë§¤ê°œë³€ìˆ˜ë¥¼ ì œê±°í•˜ê³  ë‹¤ì‹œ ì—´ì–´ì£¼ì„¸ìš”.'); } }; act.appendChild(btn) }
  else if(!STORAGE_OK){ badge.textContent='ì„ì‹œ ëª¨ë“œ(ì €ì¥ ì œí•œ)'; banner.style.display='block'; msg.textContent='ë¡œì»¬ ì €ì¥ì†Œ ì‚¬ìš©ì´ ì œí•œë˜ì–´ ì„ì‹œ ì €ì¥ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.' }
  else{ badge.textContent='ë¡œì»¬ ëª¨ë“œ'; banner.style.display='none' }
}

/* -------------------- ê¸°ë³¸ í”„ë¦¬ì…‹ -------------------- */
const DEFAULTS = {
  locations:[
    {id:'phub',label:'í¬í•­í—ˆë¸Œ',color:'#4f46e5',address:'',map:''},
    {id:'seoul',label:'ì„œìš¸í—ˆë¸Œ(ê°•ë‚¨)',color:'#06b6d4',address:'',map:''},
    {id:'busan',label:'ë¶€ì‚°í—ˆë¸Œ',color:'#f97316',address:'',map:''},
    {id:'daegu',label:'ëŒ€êµ¬ì§€ì‚¬',color:'#10b981',address:'',map:''}
  ],
  timeslots:[
    {id:'allday',label:'ì¢…ì¼',allDay:true},
    {id:'t10',label:'10:00â€“12:00',start:'10:00',end:'12:00'},
    {id:'t14',label:'14:00â€“16:00',start:'14:00',end:'16:00'},
    {id:'t19',label:'19:00â€“21:00',start:'19:00',end:'21:00'}
  ],
  instructors:[
    {id:'kim',label:'ê¹€ì°½ìˆ˜',photo:''},
    {id:'hong',label:'í™ê¸¸ë™',photo:''},
    {id:'lee',label:'ì´ì˜í¬',photo:''}
  ],
  supporters:[
    {id:'sa',label:'ì„œí¬í„°A',photo:''},
    {id:'sb',label:'ì„œí¬í„°B',photo:''}
  ],
  meetings:[
    {id:'m1',label:'ì‹ ê·œì„¤ëª…íšŒ',desc:'ì‹ ê·œ íŒŒíŠ¸ë„ˆ ì˜¤ë¦¬ì—”í…Œì´ì…˜ Â· ë„¤íŠ¸ì›Œí‚¹ Â· ì¤€ë¹„ë¬¼: í•„ê¸°ë„êµ¬'},
    {id:'m2',label:'ìŠ¤í„°ë””',desc:'ì±•í„°ë³„ í† ë¡ /ë°œí‘œ Â· ì „ì› í•„ì°¸'},
    {id:'m3',label:'ì›ë°ì´ ì„¸ë¯¸ë‚˜',desc:'í•µì‹¬ ì»¤ë¦¬í˜ëŸ¼ ì••ì¶• ì§„í–‰'}
  ],
  output:{title:'TEAM CHANCE ì¼ì •',sub:'ì£¼ê°„ íƒ€ì„í‘œ',accent:'#4f46e5',cardSize:'1080x1350'},
  cardLayout:{
    order:['brand','header','hero','content','footer'],
    show:{brand:true,header:true,hero:true,place:true,address:true,map:true,desc:true,supporters:true,footer:true},
    options:{
      spaceScale:.76,fontScale:1.08,hideEmpty:true,
      f:{meeting:32,time:14,name:22,label:13,value:15,footer:12,desc:15,supcap:12,brand:14},
      sizes:{avatar:110}, supportersSize:40, supportersPos:'left',
      align:{header:'left',hero:'center',supporters:'left'},
      infoAnchor:'right', infoWidthPct:56, infoOffsetX:0, infoOffsetY:0, heroGap:14,
      heroOffsetX:0, heroOffsetY:0,
      supportersOffsetX:0, supportersOffsetY:0,
      heroBg:'', heroFit:'cover', heroPosX:'50%', heroPosY:'50%',
      headerBg:'', headerFit:'cover', headerPosX:'50%', headerPosY:'50%',
      heroTagText:'', heroTagSize:28, heroTagX:'50%', heroTagY:'50%', heroTagColor:'#ffffff',
      brandTitle:'ZiNRAi KOREA',
      footer1:'Awaken the MovementğŸŒŠ', footer2:'tmThis is ZiNRAiğŸ”¥',
      routeMaxPx:220
    }
  }
};

/* -------------------- ì €ì¥ì†Œ -------------------- */
const PresetStore=(()=>{
  const KEY='team-calendar-presets-v17-zinrai';
  function normalize(p){ // ê¸°ë³¸ê°’ê³¼ ê¹Šì€ ë³‘í•©
    const base = JSON.parse(JSON.stringify(DEFAULTS));
    const merged = deepMerge(base, p||{});
    // í•„ìˆ˜ ë…¸ë“œ ë³´ì •
    merged.cardLayout = merged.cardLayout || JSON.parse(JSON.stringify(DEFAULTS.cardLayout));
    merged.cardLayout.options = merged.cardLayout.options || JSON.parse(JSON.stringify(DEFAULTS.cardLayout.options));
    merged.cardLayout.show = merged.cardLayout.show || JSON.parse(JSON.stringify(DEFAULTS.cardLayout.show));
    merged.cardLayout.order = Array.isArray(merged.cardLayout.order)?merged.cardLayout.order:JSON.parse(JSON.stringify(DEFAULTS.cardLayout.order));
    return merged;
  }
  const load=()=>{
    if(SHARE_DATA?.presets) return normalize(SHARE_DATA.presets);
    if(STORAGE_OK){
      try{const raw=JSON.parse(localStorage.getItem(KEY)||'{}'); return normalize(raw)}catch(e){return JSON.parse(JSON.stringify(DEFAULTS))}
    }
    if(!window.__memPresets) window.__memPresets=JSON.parse(JSON.stringify(DEFAULTS));
    return normalize(window.__memPresets);
  };
  const save=p=>{
    if(SHARE_DATA) return; // ë·°ì–´ëª¨ë“œ ì €ì¥X
    const norm=normalize(p);
    try{ if(STORAGE_OK) localStorage.setItem(KEY, JSON.stringify(norm)); else window.__memPresets=norm; }
    catch(e){ toast('ì„¤ì • ì €ì¥ ì‹¤íŒ¨(ì €ì¥ ì œí•œ)') }
  };
  return {load,save,KEY};
})();
let PRESETS = PresetStore.load();

const EventStore=(()=>{
  const KEY='team-calendar-events-v3';
  const read=()=>SHARE_DATA?.events?SHARE_DATA.events:(STORAGE_OK?JSON.parse(localStorage.getItem(KEY)||'[]'):(window.__memEvents||[]));
  const write=rows=>{ if(SHARE_DATA) return true; try{ if(STORAGE_OK) localStorage.setItem(KEY, JSON.stringify(rows)); else window.__memEvents = JSON.parse(JSON.stringify(rows)); return true }catch(e){ window.__memEvents = JSON.parse(JSON.stringify(rows)); toast('ë””ìŠ¤í¬ ì €ì¥ ì œí•œìœ¼ë¡œ ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'); return false }};
  function list(){
    return read().map(r=>({
      id:r.id,title:r.title,start:r.start,end:r.end,allDay:!!r.allDay,
      backgroundColor:r.color,borderColor:r.color,textColor:textColorFor(r.color),
      extendedProps:{
        location:r.location||'',instructor:r.instructor||'',
        locId:r.locId||'',slotId:r.slotId||'',instrId:r.instrId||'',
        meetingId:r.meetingId||'',meetingName:r.meetingName||'',
        address:r.address||'',map:r.map||'',
        routeImage:r.routeImage||'', routeMaxPx:r.routeMaxPx||undefined,
        supporters:r.supporters||[],heroPhoto:r.heroPhoto||'',desc:r.desc||'',color:r.color
      }
    }))
  }
  async function upsert(ev){
    if(SHARE_DATA){ toast('ë·°ì–´ ëª¨ë“œì—ì„œëŠ” ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return {ok:false,ev}; }
    const rows=read();
    const ep=ev.extendedProps||{};
    const id=ev.id||uuid();
    const row={ id,title:ev.title,start:ev.start,end:ev.end,allDay:!!ev.allDay,
      location:ep.location||'',instructor:ep.instructor||'',
      locId:ep.locId||'',slotId:ep.slotId||'',instrId:ep.instrId||'',
      meetingId:ep.meetingId||'',meetingName:ep.meetingName||'',
      address:ep.address||'',map:ep.map||'',
      routeImage:ep.routeImage||'', routeMaxPx:ep.routeMaxPx||undefined,
      supporters:ep.supporters||[], heroPhoto:ep.heroPhoto||'', desc:ep.desc||'',
      color:ep.color||ev.backgroundColor||'#4f46e5'
    };
    const i=rows.findIndex(r=>r.id===id); if(i>=0) rows[i]=row; else rows.push(row);
    const ok=write(rows); return {ok,ev:{...ev,id}};
  }
  async function remove(id){ if(SHARE_DATA) return false; const rows=read().filter(r=>r.id!==id); return write(rows) }
  return {list,upsert,remove,KEY};
})();

/* -------------------- ìº˜ë¦°ë” -------------------- */
let calendar,currentView='weekShare',anchorDate=new Date(),lastEv=null;

function initCalendar(){
  const el=$("#calendar");
  calendar = new FullCalendar.Calendar(el,{
    initialView:'dayGridMonth', locale:'ko', height:'auto',
    headerToolbar:false, firstDay:1, timeZone:'local',
    events: EventStore.list(),
    eventContent: arg=>{
      // ì›”ê°„: ì¥ì†Œ + ì‹œê°„
      const p = arg.event.extendedProps;
      const time = arg.event.allDay ? 'ì¢…ì¼' :
        `${new Date(arg.event.start).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'})}â€“${new Date(arg.event.end).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'})}`;
      const color = p.color || arg.event.backgroundColor || '#4f46e5';
      const dot = `<span class="mm-dot" style="background:${color}"></span>`;
      return { html: `<div class="mon-mini">
        <div class="mm-top">${dot}<div class="mm-place">${esc(p.location||arg.event.title||'')}</div></div>
        <div class="mm-time">${time}</div>
      </div>` };
    },
    dateClick: info=>{
      if(currentView==='weekShare') openQuickAdd(info.date);
    },
    eventClick: info=>{
      openCard(info.event);
    }
  });
  calendar.render();
  switchView('weekShare'); // ê¸°ë³¸ ì£¼ê°„
}
function esc(s){return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]) ) }

function setRangeTitle(){
  const t=$("#exportTitle"); t.textContent=$("#calendarTitle").value||'';
  const viewStart = startOfWeek(anchorDate);
  const viewEnd = new Date(viewStart); viewEnd.setDate(viewEnd.getDate()+5);
  $("#exportRange").textContent = `${fmt(viewStart,{month:'long',day:'numeric'})} â€“ ${fmt(viewEnd,{month:'long',day:'numeric'})}`;
}
function startOfWeek(date){const d=new Date(date); const day=d.getDay(); const diff=(day===0?-6:1-day); d.setDate(d.getDate()+diff); d.setHours(0,0,0,0); return d}

function switchView(v){
  currentView=v;
  if(v==='dayGridMonth' || v==='listWeek'){
    $("#calendar").style.display='block';
    $("#weekBoard").style.display='none';
    calendar.changeView(v==='listWeek'?'listWeek':'dayGridMonth', anchorDate);
  }else{
    $("#calendar").style.display='none';
    $("#weekBoard").style.display='block';
    renderWeekBoard();
  }
  setRangeTitle();
}
function renderWeekBoard(){
  const grid=$("#weekGrid"); grid.innerHTML='';
  const start = startOfWeek(anchorDate);
  const days = ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  for(let i=0;i<6;i++){
    const d=new Date(start); d.setDate(d.getDate()+i);
    const card=document.createElement('div');
    card.className='day-card';
    card.innerHTML=`<div class="day-head">
      <div class="day-name">${days[i]}</div>
      <div class="day-date">${fmt(d,{month:'numeric',day:'numeric'})}</div>
    </div>
    <div class="event-list"></div>`;
    card.addEventListener('click',e=>{ if(e.target.closest('.event-chip')) return; openQuickAdd(d) });
    grid.appendChild(card);

    // events for day
    const evs = calendar.getEvents().filter(ev=>{
      const s=new Date(ev.start); return s.toDateString()===d.toDateString()
    }).sort((a,b)=>+a.start-+b.start);
    const list=card.querySelector('.event-list');
    if(!evs.length){ card.classList.add('empty'); }
    evs.forEach(ev=>{
      card.classList.remove('empty');
      const p=ev.extendedProps;
      const time=ev.allDay?'ì¢…ì¼':`${fmt(ev.start,{hour:'2-digit',minute:'2-digit'})}â€“${fmt(ev.end,{hour:'2-digit',minute:'2-digit'})}`;
      const chip=document.createElement('div');
      chip.className='event-chip'; chip.style.setProperty('--c',p.color||ev.backgroundColor||'#4f46e5');
      chip.innerHTML=`
        <div class="top">
          <div class="main">
            ${p.heroPhoto?`<img class="avatar" src="${p.heroPhoto}">`:`<img class="avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='100%25' height='100%25' fill='%23eef2ff'/%3E%3Ctext x='50%25' y='54%25' text-anchor='middle' fill='%23667185' font-size='14' font-weight='700'%3Eí”„ë¡œí•„%3C/text%3E%3C/svg%3E">`}
            <div class="main-ttl">${esc(p.location||'')}<span class="slash"> / </span>${esc(p.instructor||'')}</div>
          </div>
          <div class="right">
            <div class="time-badge">${time}</div>
            <button class="edit-btn">ìˆ˜ì •</button>
          </div>
        </div>
        <div class="meta">
          <div class="addr-row">
            <span>ğŸ“ ${esc(p.address||'')}</span>
            ${p.map?`<a href="${p.map}" target="_blank" class="map-btn">ì§€ë„</a>`:''}
          </div>
        </div>`;
      chip.addEventListener('click',e=>{ if(e.target.classList.contains('edit-btn')) return; openCard(ev) });
      chip.querySelector('.edit-btn').addEventListener('click',()=>openQuickAdd(new Date(ev.start),ev));
      list.appendChild(chip);
    });
  }
}

/* -------------------- ë¹ ë¥¸ ì¼ì • ì¶”ê°€ -------------------- */
const qState={date:new Date(),locId:null,slotId:null,instrId:null,meetingId:null,routeImage:'',routeMaxPx:undefined,supporters:[],editingId:null};
function openQuickAdd(date, ev){
  if(SHARE_DATA){ toast('ë·°ì–´ ëª¨ë“œì—ì„œëŠ” ì¶”ê°€/ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return }
  $("#quickAdd").classList.add('show');
  qState.date=date||new Date(); qState.editingId=null; qState.routeImage=''; qState.routeMaxPx=undefined; qState.supporters=[];
  const def = loadQuickDefaults();
  qState.locId=def.locId||PRESETS.locations[0]?.id;
  qState.slotId=def.slotId||PRESETS.timeslots[0]?.id;
  qState.instrId=def.instrId||PRESETS.instructors[0]?.id;
  qState.meetingId=def.meetingId||PRESETS.meetings[0]?.id;
  $("#qMemo").value=def.memo||'';

  if(ev){ // edit
    qState.editingId=ev.id;
    const p=ev.extendedProps; qState.locId=p.locId||findByLabel(PRESETS.locations,p.location)?.id||PRESETS.locations[0].id;
    qState.slotId=p.slotId||PRESETS.timeslots[0].id;
    qState.instrId=p.instrId||findByLabel(PRESETS.instructors,p.instructor)?.id||PRESETS.instructors[0].id;
    qState.meetingId=p.meetingId||findByLabel(PRESETS.meetings,p.meetingName)?.id||PRESETS.meetings[0].id;
    $("#qMemo").value=p.desc||'';
    qState.routeImage=p.routeImage||'';
    qState.routeMaxPx=p.routeMaxPx||undefined;
    qState.supporters=(p.supporters||[]).map(s=>({id:uuid(),name:s.name||'',photo:s.photo||''}));
    $("#qRoutePreview").src=qState.routeImage||'';
  }else{
    $("#qRoutePreview").src='';
  }

  renderQuickOptions();
  renderSupporterList();
}
function closeQuickAdd(){ $("#quickAdd").classList.remove('show') }
$("#openQuickBtn").addEventListener('click',()=>openQuickAdd(new Date()));

function findByLabel(arr,label){ return arr.find(x=>x.label===label) }
function renderQuickOptions(){
  const mk=(arr,sel,click,withColor=false,withAvatar=false)=>arr.map(x=>{
    const div=document.createElement('div'); div.className='opt'+(sel===x.id?' selected':'');
    if(withColor) div.innerHTML=`<span class="dot" style="background:${x.color||'#94a3b8'}"></span>${x.label}`;
    else if(withAvatar) div.innerHTML=`<img src="${x.photo||'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2230%22 height=%2230%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23eef2ff%22/%3E%3C/svg%3E'}" alt="">${x.label}`;
    else div.textContent=x.label;
    div.onclick=()=>{ click(x.id); renderQuickOptions() };
    return div;
  });
  const loc=$("#qLoc"); loc.innerHTML=''; mk(PRESETS.locations,qState.locId,(id)=>qState.locId=id,true).forEach(n=>loc.appendChild(n));
  const time=$("#qTime"); time.innerHTML=''; mk(PRESETS.timeslots,qState.slotId,(id)=>qState.slotId=id).forEach(n=>time.appendChild(n));
  const ins=$("#qIns"); ins.innerHTML=''; mk(PRESETS.instructors,qState.instrId,(id)=>qState.instrId=id,false,true).forEach(n=>ins.appendChild(n));
  const mt=$("#qMeet"); mt.innerHTML=''; mk(PRESETS.meetings,qState.meetingId,(id)=>qState.meetingId=id).forEach(n=>mt.appendChild(n));

  const supPreset=$("#qSupPreset"); supPreset.innerHTML='';
  PRESETS.supporters.forEach(s=>{
    const o=document.createElement('div'); o.className='opt'; o.innerHTML=`<img src="${s.photo||'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2218%22 height=%2218%22%3E%3Crect width=%22100%25%22 height=%221100%25%22 fill=%22%23eef2ff%22/%3E%3C/svg%3E'}">${s.label}`;
    o.onclick=()=>{ qState.supporters.push({id:uuid(),name:s.label,photo:s.photo||''}); renderSupporterList() };
    supPreset.appendChild(o);
  });
}
function renderSupporterList(){
  const box=$("#qSupList"); box.innerHTML='';
  qState.supporters.forEach((s,i)=>{
    const it=document.createElement('div'); it.className='sup-item'; it.draggable=true;
    it.innerHTML=`<img src="${s.photo||'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2248%22 height=%2248%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23eef2ff%22/%3E%3C/svg%3E'}"><input value="${s.name||''}" placeholder="ì´ë¦„"><button class="btn">ì‚¬ì§„</button><button class="btn del">ì‚­ì œ</button>`;
    it.querySelector('input').oninput=e=>{ qState.supporters[i].name=e.target.value };
    it.querySelector('.btn').onclick=async ()=>{ const f=await pickFile(); const url=await readFileAsDataURL(f); if(url){ qState.supporters[i].photo=url; it.querySelector('img').src=url; } };
    it.querySelector('.del').onclick=()=>{ qState.supporters.splice(i,1); renderSupporterList() };
    // drag reorder
    it.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain',i) });
    it.addEventListener('dragover',e=>{ e.preventDefault(); it.style.background='#f8fafc' });
    it.addEventListener('dragleave',()=>it.style.background='#fff');
    it.addEventListener('drop',e=>{ e.preventDefault(); it.style.background='#fff'; const from=+e.dataTransfer.getData('text/plain'); const to=i; const [m]=qState.supporters.splice(from,1); qState.supporters.splice(to,0,m); renderSupporterList() });
    box.appendChild(it);
  });
}
function pickFile(){ return new Promise(res=>{ const inp=document.createElement('input'); inp.type='file'; inp.accept='image/*'; inp.onchange=()=>res(inp.files[0]||null); inp.click() }) }

$("#qClose").onclick=closeQuickAdd; $("#qCancel").onclick=closeQuickAdd;
$("#qRouteFile").onchange=async e=>{
  const f=e.target.files[0]; const url=await readFileAsDataURL(f); qState.routeImage=url||''; $("#qRoutePreview").src=qState.routeImage||'';
  // ë¯¸ë¦¬ë³´ê¸° ë†’ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì €ì¥
  setTimeout(()=>{ qState.routeMaxPx = Math.round($("#qRoutePreview").getBoundingClientRect().height || 220); },0);
};
$("#qSupAdd").onclick=()=>{ qState.supporters.push({id:uuid(),name:'',photo:''}); renderSupporterList() };

$("#memoFullBtn").onclick=()=>{
  const full=document.createElement('div'); full.className='modal show';
  full.innerHTML=`<div class="scrim"></div><div class="dialog" style="width:min(900px,96vw)"><h3 style="margin:0 0 10px">ìƒì„¸ë‚´ìš© ì „ì²´í™”ë©´</h3><textarea id="fullMemo" style="width:100%;height:60vh;border:1px solid #e5e7eb;border-radius:12px;padding:12px"></textarea><div class="sticky-bar"><button id="closeFull">ë‹«ê¸°</button><button id="applyFull" class="primary">ì ìš©</button></div></div>`;
  document.body.appendChild(full);
  $("#fullMemo",full).value=$("#qMemo").value;
  $(".scrim",full).onclick=()=>document.body.removeChild(full);
  $("#closeFull",full).onclick=()=>document.body.removeChild(full);
  $("#applyFull",full).onclick=()=>{ $("#qMemo").value=$("#fullMemo",full).value; document.body.removeChild(full) };
}

$("#quickForm").addEventListener('submit', async e=>{
  e.preventDefault();
  try{
    if(!(qState.locId && qState.slotId && qState.instrId && qState.meetingId)){ toast('ì¥ì†ŒÂ·ì‹œê°„Â·ë‹´ë‹¹ìÂ·ëª¨ì„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”'); return }
    const loc=PRESETS.locations.find(x=>x.id===qState.locId);
    const slot=PRESETS.timeslots.find(x=>x.id===qState.slotId);
    const inst=PRESETS.instructors.find(x=>x.id===qState.instrId);
    const meet=PRESETS.meetings.find(x=>x.id===qState.meetingId);

    // time
    let sISO,eISO,allDay=false; const d=new Date(qState.date);
    if(slot?.allDay){ allDay=true; const s=new Date(d); s.setHours(0,0,0,0); const e2=new Date(d); e2.setHours(23,59,59,999); sISO=s.toISOString(); eISO=e2.toISOString(); }
    else{ const [sh,sm]=(slot.start||'00:00').split(':'), [eh,em]=(slot.end||'23:59').split(':'); const s=new Date(d), e=new Date(d); s.setHours(+sh||0,+sm||0,0,0); e.setHours(+eh||0,+em||0,0,0); sISO=s.toISOString(); eISO=e.toISOString(); }

    const color=loc?.color||PRESETS.output.accent||'#4f46e5';
    const id=qState.editingId || uuid();
    const title=`${loc?.label||''} / ${inst?.label||''}`.trim();
    const routeMaxLimit = qState.routeMaxPx || (PRESETS.cardLayout?.options?.routeMaxPx ?? 220);

    const payload={
      id,title,start:sISO,end:eISO,allDay,
      backgroundColor:color,borderColor:color,textColor:textColorFor(color),
      extendedProps:{
        location:loc?.label||'', instructor:inst?.label||'',
        locId:loc?.id||'', slotId:slot?.id||'', instrId:inst?.id||'',
        meetingId:meet?.id||'', meetingName:meet?.label||'',
        address:loc?.address||'', map:loc?.map||'',
        routeImage:qState.routeImage||'', routeMaxPx:routeMaxLimit,
        supporters:qState.supporters.map(s=>({name:s.name||'',photo:s.photo||''})),
        desc:$("#qMemo").value||'', color
      }
    };

    const {ok,ev} = await EventStore.upsert(payload);
    const exist = calendar.getEventById(id); if(exist) exist.remove();
    calendar.addEvent(payload);
    closeQuickAdd(); setRangeTitle(); if(currentView==='weekShare') renderWeekBoard();
    saveQuickDefaults(); toast(qState.editingId?'ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤': (ok?'ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤':'ì„ì‹œë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤(ì €ì¥ ì œí•œ)'));
  }catch(err){ console.error(err); toast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í”„ë¦¬ì…‹ì„ ì´ˆê¸°í™” í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); }
});
function saveQuickDefaults(){
  const def={locId:qState.locId,slotId:qState.slotId,instrId:qState.instrId,meetingId:qState.meetingId,memo:$("#qMemo").value||''};
  try{ localStorage.setItem('tc-quickdef', JSON.stringify(def)) }catch(e){}
}
function loadQuickDefaults(){ try{return JSON.parse(localStorage.getItem('tc-quickdef')||'{}')}catch(e){return {}} }

/* -------------------- ì¹´ë“œ ë§Œë“¤ê¸°/ë³´ê¸° -------------------- */
function openCard(event){
  lastEv = event;
  $("#cardModal").classList.add('show');
  renderShareCard(event);
  $("#cardMapBtn").onclick=()=>{ const p=event.extendedProps; const url = p.map && /^https?:\/\//.test(p.map)? p.map : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent((p.address||p.location||'').trim())}`; window.open(url,'_blank') };
  $("#cardEditBtn").onclick=()=>{ closeCard(); openQuickAdd(new Date(event.start),event) };
  $("#cardDelBtn").onclick=async()=>{ if(confirm('ì‚­ì œí•˜ì‹œê² ì–´ìš”?')){ await EventStore.remove(event.id); event.remove(); closeCard(); if(currentView==='weekShare') renderWeekBoard(); toast('ì‚­ì œí–ˆìŠµë‹ˆë‹¤') } };
  $("#cardPngBtn").onclick=()=>downloadCardPng();
  $("#cardCopyBtn").onclick=()=>copyCardPng();
}
function closeCard(){ $("#cardModal").classList.remove('show') }
$("#cardClose").onclick=closeCard;

function shareCardHTML(p, ev){
  const opt=PRESETS.cardLayout.options, show=PRESETS.cardLayout.show;
  const time = ev.allDay?'ì¢…ì¼':`${fmt(ev.start,{hour:'2-digit',minute:'2-digit'})}â€“${fmt(ev.end,{hour:'2-digit',minute:'2-digit'})}`;
  const supHTML = (show.supporters && (p.supporters||[]).length) ? `<div class="scv-supporters" style="--sup:${opt.supportersSize}px;justify-content:${opt.align.supporters};transform:translate(${opt.supportersOffsetX}px,${opt.supportersOffsetY}px)">${p.supporters.map(s=>`<div class="sup" draggable="true"><img src="${s.photo||placeholder(40)}"><span class="nm">${esc(s.name||'')}</span></div>`).join('')}</div>` : '';

  return `
  <div class="scv-brand">
    ${show.brand?`<div class="logo">${esc(opt.brandTitle||'')}</div>`:''}
    <div class="sub">${esc(PRESETS.output?.sub||'')}</div>
  </div>

  <div class="scv-header ${opt.headerBg?'bg':''}">
    ${opt.headerBg?`<img class="bgimg" src="${opt.headerBg}" style="object-fit:${opt.headerFit||'cover'};object-position:${opt.headerPosX||'50%'} ${opt.headerPosY||'50%'}">`:''}
    <div class="scv-hcap">
      <div class="scv-meeting" style="font-size:${opt.f.meeting}px">${esc(p.meetingName||'')}</div>
      <div class="scv-time" style="font-size:${opt.f.time}px">${time}</div>
    </div>
  </div>

  <div class="scv-hero" style="gap:${opt.heroGap||14}px">
    <div class="photo" style="--herox:${opt.heroOffsetX}px;--heroy:${opt.heroOffsetY}px;width:${opt.sizes.avatar}px;height:${opt.sizes.avatar}px">
      <img id="heroImg" src="${p.heroPhoto||placeholder(120)}" alt="">
    </div>
    <div class="namebox" style="align-items:${opt.align.hero}">
      <div id="heroName" class="name" style="font-size:${opt.f.name}px">${esc(p.instructor||'')}</div>
    </div>
    ${opt.heroTagText?`<div class="hero-tag" style="left:${opt.heroTagX};top:${opt.heroTagY};font-size:${opt.heroTagSize}px;color:${opt.heroTagColor}">${esc(opt.heroTagText)}</div>`:''}
  </div>

  ${supHTML}

  <div class="scv-content" style="flex-direction:${opt.infoAnchor==='right'?'row':'row-reverse'}">
    <div class="scv-info" style="flex-basis:${opt.infoWidthPct}%;transform:translate(${opt.infoOffsetX}px,${opt.infoOffsetY}px)">
      ${show.place?`<div class="scv-section"><div class="scv-row"><div class="scv-label">ì¥ì†Œ</div><div class="scv-value">${esc(p.location||'')}</div></div></div>`:''}
      ${show.address?`<div class="scv-section"><div class="scv-row"><div class="scv-label">ì£¼ì†Œ</div><div class="scv-value">${esc(p.address||'')}</div></div></div>`:''}
      ${show.map && p.routeImage?`<div class="scv-section scv-route"><div class="frame"><img id="routeImg" src="${p.routeImage}" style="max-height:${p.routeMaxPx||opt.routeMaxPx||220}px"></div></div>`:''}
      ${show.desc && p.desc?`<div class="scv-section scv-desc"><div class="scv-label">ìƒì„¸ë‚´ìš©</div><div class="scv-value">${esc(p.desc)}</div></div>`:''}
    </div>
  </div>

  ${show.footer?`<div class="scv-footer"><div class="f1">${esc(opt.footer1||'')}</div>Â·<div class="f2">${esc(opt.footer2||'')}</div></div>`:''}
  `;
}
function placeholder(size){ return `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${size}' height='${size}'%3E%3Crect width='100%25' height='100%25' fill='%23eef2ff'/%3E%3Ctext x='50%25' y='54%25' text-anchor='middle' fill='%23667185' font-size='14' font-weight='700'%3Eì´ë¯¸ì§€%3C/text%3E%3C/svg%3E` }

function renderShareCard(ev){
  const p={...ev.extendedProps, meetingName:ev.extendedProps.meetingName};
  const opt=PRESETS.cardLayout.options;

  const sc=$("#shareCard");
  const [w,h]= (PRESETS.output.cardSize||'1080x1350').split('x').map(n=>+n||0);
  sc.style.setProperty('--cw', w||540);
  sc.style.setProperty('--ch', h||675);
  sc.style.setProperty('--f-meeting', opt.f.meeting);
  sc.style.setProperty('--f-time', opt.f.time);
  sc.style.setProperty('--f-name', opt.f.name);
  sc.style.setProperty('--f-label', opt.f.label);
  sc.style.setProperty('--f-value', opt.f.value);
  sc.style.setProperty('--f-desc', opt.f.desc);
  sc.style.setProperty('--f-supcap', opt.f.supcap);
  sc.style.setProperty('--f-brand', opt.f.brand);
  sc.style.setProperty('--av', opt.sizes.avatar+'px');
  sc.style.setProperty('--sup', opt.supportersSize+'px');
  sc.innerHTML = shareCardHTML(p, ev);

  // ì¸í„°ë™ì…˜: íˆì–´ë¡œ ì´ë¯¸ì§€/ì´ë¦„ êµì²´
  $("#heroImg").onclick=async ()=>{ if(SHARE_DATA) return; const f=await pickFile(); const url=await readFileAsDataURL(f); if(url){ ev.setExtendedProp('heroPhoto',url); $("#heroImg").src=url; await EventStore.upsert(ev); if(currentView==='weekShare') renderWeekBoard() } };
  $("#heroName").onclick=async ()=>{ if(SHARE_DATA) return; const name=prompt('ë‹´ë‹¹ì ì´ë¦„', ev.extendedProps.instructor||''); if(name!=null){ ev.setExtendedProp('instructor',name); $("#heroName").textContent=name; const parts=ev.title.split('/'); ev.setProp('title', `${(ev.extendedProps.location||'').trim()} / ${name}`.trim()); await EventStore.upsert(ev); if(currentView==='weekShare') renderWeekBoard() } };

  // ì„œí¬í„°: ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½ + ê°œë³„ í´ë¦­ ì‚¬ì§„/ì´ë¦„ ë³€ê²½
  $$(".scv-supporters .sup", sc).forEach((el,idx)=>{
    el.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain', idx) });
    el.addEventListener('dragover',e=>e.preventDefault());
    el.addEventListener('drop',e=>{ e.preventDefault(); const from=+e.dataTransfer.getData('text/plain'); const to=idx; const arr=[...(ev.extendedProps.supporters||[])]; const [m]=arr.splice(from,1); arr.splice(to,0,m); ev.setExtendedProp('supporters',arr); renderShareCard(ev); EventStore.upsert(ev) });
    const img=el.querySelector('img'); const nm=el.querySelector('.nm');
    img.onclick=async ()=>{ if(SHARE_DATA) return; const f=await pickFile(); const url=await readFileAsDataURL(f); if(url){ const arr=[...(ev.extendedProps.supporters||[])]; arr[idx]={...(arr[idx]||{}),photo:url}; ev.setExtendedProp('supporters',arr); img.src=url; await EventStore.upsert(ev) } };
    nm.onclick=async ()=>{ if(SHARE_DATA) return; const name=prompt('ì„œí¬í„° ì´ë¦„', nm.textContent||''); if(name!=null){ const arr=[...(ev.extendedProps.supporters||[])]; arr[idx]={...(arr[idx]||{}),name}; ev.setExtendedProp('supporters',arr); nm.textContent=name; await EventStore.upsert(ev) } };
  });
}

async function downloadCardPng(){
  const node=$("#shareCard"); // ì›ë³¸ í¬ê¸° ê¸°ì¤€ ìŠ¤ëƒ…
  const [w,h]=(PRESETS.output.cardSize||'1080x1350').split('x').map(n=>+n||0);
  const canvas=await html2canvas(node,{scale:2,backgroundColor:'#ffffff', width:w, height:h, useCORS:true});
  const url=canvas.toDataURL('image/png');
  const a=document.createElement('a'); a.href=url; a.download=`schedule-card-${Date.now()}.png`; a.click();
}
async function copyCardPng(){
  try{
    const node=$("#shareCard");
    const [w,h]=(PRESETS.output.cardSize||'1080x1350').split('x').map(n=>+n||0);
    const canvas=await html2canvas(node,{scale:2,backgroundColor:'#ffffff', width:w, height:h, useCORS:true});
    canvas.toBlob(async blob=>{
      await navigator.clipboard.write([new ClipboardItem({'image/png':blob})]);
      toast('í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆìŠµë‹ˆë‹¤');
    })
  }catch(e){ toast('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨: PNG ì €ì¥ì„ ì‚¬ìš©í•˜ì„¸ìš”') }
}

/* -------------------- ì¹´ë“œ íŠœë„ˆ -------------------- */
function openTuner(){
  $("#tuner").classList.add('show');
  const o=PRESETS.cardLayout.options;
  $("#optSpace").value=o.spaceScale; $("#optFont").value=o.fontScale;
  $("#optAv").value=o.sizes.avatar; $("#optSup").value=o.supportersSize;
  $("#optFMeeting").value=o.f.meeting; $("#optFTime").value=o.f.time;
  $("#optFName").value=o.f.name; $("#optFDesc").value=o.f.desc;
  $("#optInfoW").value=o.infoWidthPct; $("#optInfoAnchor").value=o.infoAnchor;
  $("#optSupAlign").value=o.align.supporters; $("#optSupX").value=o.supportersOffsetX; $("#optSupY").value=o.supportersOffsetY;
  $("#optHeroX").value=o.heroOffsetX; $("#optHeroY").value=o.heroOffsetY;
  $("#optHeroTag").value=o.heroTagText; $("#optHeroTagSize").value=o.heroTagSize;
  $("#optHeaderPosY").value=parseInt((o.headerPosY||'50%').replace('%',''))||50;
  $("#optHeroPosY").value=parseInt((o.heroPosY||'50%').replace('%',''))||50;
  $("#optHideEmpty").checked=!!o.hideEmpty;
  $("#optCardSize").value=PRESETS.output.cardSize||'1080x1350';
  $("#optRouteMax").value=o.routeMaxPx||220;
  $("#optBrand").value=o.brandTitle||''; $("#optF1").value=o.footer1||''; $("#optF2").value=o.footer2||'';
}
$("#tunerOpenBtn").onclick=()=>openTuner();
$("#tunerClose,#tunerCloseBtn").onclick=()=>$("#tuner").classList.remove('show');

$("#optHeaderBg").onchange=async e=>{ const url=await readFileAsDataURL(e.target.files[0]); if(url){ PRESETS.cardLayout.options.headerBg=url; PresetStore.save(PRESETS); if(lastEv) renderShareCard(lastEv) } };
$("#optHeroBg").onchange=async e=>{ const url=await readFileAsDataURL(e.target.files[0]); if(url){ PRESETS.cardLayout.options.heroBg=url; PresetStore.save(PRESETS); if(lastEv) renderShareCard(lastEv) } };

$("#tunerApply").onclick=()=>{
  const o=PRESETS.cardLayout.options;
  o.spaceScale=+$("#optSpace").value; o.fontScale=+$("#optFont").value;
  o.sizes.avatar=+$("#optAv").value; o.supportersSize=+$("#optSup").value;
  o.f.meeting=+$("#optFMeeting").value; o.f.time=+$("#optFTime").value; o.f.name=+$("#optFName").value; o.f.desc=+$("#optFDesc").value;
  o.infoWidthPct=+$("#optInfoW").value; o.infoAnchor=$("#optInfoAnchor").value;
  o.align.supporters=$("#optSupAlign").value;
  o.supportersOffsetX=+$("#optSupX").value; o.supportersOffsetY=+$("#optSupY").value;
  o.heroOffsetX=+$("#optHeroX").value; o.heroOffsetY=+$("#optHeroY").value;
  o.heroTagText=$("#optHeroTag").value; o.heroTagSize=+$("#optHeroTagSize").value;
  o.headerPosY=$("#optHeaderPosY").value+'%'; o.heroPosY=$("#optHeroPosY").value+'%';
  o.hideEmpty=$("#optHideEmpty").checked;
  PRESETS.output.cardSize=$("#optCardSize").value;
  o.routeMaxPx=+$("#optRouteMax").value;
  o.brandTitle=$("#optBrand").value; o.footer1=$("#optF1").value; o.footer2=$("#optF2").value;
  PresetStore.save(PRESETS);
  if(lastEv) renderShareCard(lastEv);
  toast('ì ìš©í–ˆìŠµë‹ˆë‹¤');
};
$("#tunerSave").onclick=()=>{ $("#tunerApply").click(); toast('ê¸°ë³¸ê°’ìœ¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤') };

/* -------------------- ê³µìœ  ë§í¬ -------------------- */
$("#shareLinkBtn").onclick=async ()=>{
  const payload={presets:PRESETS, events:JSON.parse(localStorage.getItem(EventStore.KEY)||'[]')};
  const s=btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
  const url=location.origin+location.pathname+'?s='+s;
  try{ await navigator.clipboard.writeText(url); toast('ê³µìœ  ë§í¬ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤') }catch(e){ prompt('ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”', url) }
};
$("#openShareBtn").onclick=()=>{
  const payload={presets:PRESETS, events:JSON.parse(localStorage.getItem(EventStore.KEY)||'[]')};
  const s=btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
  window.open(location.origin+location.pathname+'?s='+s,'_blank');
};

/* -------------------- ë„¤ë¹„/ë²„íŠ¼ -------------------- */
$("#viewSel").onchange=e=>switchView(e.target.value);
$("#todayBtn").onclick=()=>{ anchorDate=new Date(); if(currentView==='weekShare') renderWeekBoard(); else calendar.today(); setRangeTitle() };
$("#prevBtn").onclick=()=>{ anchorDate.setDate(anchorDate.getDate()-7); if(currentView==='weekShare') renderWeekBoard(); else calendar.prev(); setRangeTitle() };
$("#nextBtn").onclick=()=>{ anchorDate.setDate(anchorDate.getDate()+7); if(currentView==='weekShare') renderWeekBoard(); else calendar.next(); setRangeTitle() };
$("#calendarTitle").oninput=e=>{ $("#exportTitle").textContent=e.target.value||'' };

/* -------------------- ì´ˆê¹ƒê°’/ì‹œì‘ -------------------- */
document.addEventListener('DOMContentLoaded',()=>{
  showModeBanner();
  initCalendar();
  setRangeTitle();
});

/* -------------------- ë³´ì¡° -------------------- */
function escNewline(s){return (s||'').replace(/\n/g,'<br/>')}
</script>
</body>
</html>